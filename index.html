<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Location Tracking</title>
    <style>
        body {
            text-align: center;
        }
        #floor-map {
            width: 90%;
            height: 400px;
            background-color: lightgray;
            position: relative;
            margin: 20px auto;
            overflow: hidden;
        }
        #user-dot {
            width: 20px;
            height: 20px;
            background-color: blue;
            border-radius: 50%;
            position: absolute;
            top: 100px; /* Initial Y position */
            left: 100px; /* Initial X position */
            transition: all 0.2s ease-in-out;
        }
        #start-btn {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <h2>Live Location Tracking on Floor Map</h2>
    <button id="start-btn">Start Tracking</button>
    <div id="floor-map">
        <div id="user-dot"></div>
    </div>
    <div id="messages"></div>

    <script>
        let position = { x: 100, y: 100 }; // Initial position
        const STEP_SIZE = 10; // Pixels per step

        let velocity = { x: 0, y: 0 }; // Velocity in x and y direction
        let lastTimestamp = null;
        let prevAcceleration = { x: 0, y: 0, z: 0 };
        let gravity = { x: 0, y: 0, z: 0 };
        let alpha = 0.8; // Filter strength

        document.getElementById("start-btn").addEventListener("click", requestPermissions);

        async function requestPermissions() {
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                try {
                    let response = await DeviceMotionEvent.requestPermission();
                    if (response === 'granted') {
                        startTracking();
                    }
                } catch (e) {
                    console.error("Error requesting permission:", e);
                }
            } else {
                startTracking();
            }
        }

        function startTracking() {
            window.addEventListener("deviceorientation", (event) => {
                handleOrientation(event);
            });

            window.addEventListener("devicemotion", (event) => {
                handleMotion(event);
            });
        }

        function handleOrientation(event) {
            let heading = event.alpha; // Compass direction in degrees
            document.getElementById('messages').innerHTML = `Heading: ${heading}`;
        }

        function handleMotion(event) {
            let acc = event.accelerationIncludingGravity;
            let timestamp = event.timeStamp;

            // High-pass filter to remove gravity
            gravity.x = alpha * gravity.x + (1 - alpha) * acc.x;
            gravity.y = alpha * gravity.y + (1 - alpha) * acc.y;
            gravity.z = alpha * gravity.z + (1 - alpha) * acc.z;

            let realAccX = acc.x - gravity.x;
            let realAccY = acc.y - gravity.y;

            if (lastTimestamp) {
                let deltaTime = (timestamp - lastTimestamp) / 1000; // Convert to seconds

                // Integrate acceleration to get velocity
                velocity.x += realAccX * deltaTime;
                velocity.y += realAccY * deltaTime;

                // Integrate velocity to get displacement
                position.x += velocity.x * deltaTime * STEP_SIZE;
                position.y += velocity.y * deltaTime * STEP_SIZE;

                // Apply friction to prevent drift
                velocity.x *= 0.9;
                velocity.y *= 0.9;

                moveUser();
            }

            lastTimestamp = timestamp;
        }

        function moveUser() {
            document.getElementById('')
            document.getElementById("user-dot").style.transform = `translate(${position.x}px, ${position.y}px)`;
        }
    </script>

</body>
</html>
